<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jolly Dollars Fraud Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .fraud-rate { color: #e74c3c; }
        .pass-rate { color: #27ae60; }
        .review-rate { color: #f39c12; }
        .false-positive-rate { color: #9b59b6; }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .chart-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            color: #2c3e50;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.2em;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .stat-number {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸª™ Jolly Dollars Fraud Dashboard</h1>
            <p>Comprehensive analysis of fraud detection patterns and model performance</p>
        </div>

        <div id="loading" class="loading">
            Loading dashboard data...
        </div>

        <div id="dashboard" style="display: none;">
            <!-- Summary Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-applications">-</div>
                    <div class="stat-label">Total Applications</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number fraud-rate" id="fraud-rate">-</div>
                    <div class="stat-label">Fraud Rate %</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number pass-rate" id="pass-rate">-</div>
                    <div class="stat-label">Pass Rate %</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number review-rate" id="review-rate">-</div>
                    <div class="stat-label">Manual Review %</div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <!-- Fraud Status Distribution -->
                <div class="chart-container">
                    <h3 class="chart-title">Fraud Status Distribution (%)</h3>
                    <div class="chart-wrapper">
                        <canvas id="fraudStatusChart"></canvas>
                    </div>
                </div>

                <!-- Model Performance -->
                <div class="chart-container">
                    <h3 class="chart-title">Model Performance</h3>
                    <div class="chart-wrapper">
                        <canvas id="modelPerformanceChart"></canvas>
                    </div>
                </div>

                <!-- Monthly Trends -->
                <div class="chart-container full-width">
                    <h3 class="chart-title">Monthly Application Volume & Fraud Rate</h3>
                    <div class="chart-wrapper">
                        <canvas id="monthlyTrendsChart"></canvas>
                    </div>
                </div>

                <!-- Behavior Check Scores -->
                <div class="chart-container">
                    <h3 class="chart-title">Behavior Check Score Distribution</h3>
                    <div class="chart-wrapper">
                        <canvas id="behaviorScoresChart"></canvas>
                    </div>
                </div>

                <!-- Device Check Scores -->
                <div class="chart-container">
                    <h3 class="chart-title">Device Check Score Distribution</h3>
                    <div class="chart-wrapper">
                        <canvas id="deviceScoresChart"></canvas>
                    </div>
                </div>

                <!-- Daily Volume Trends -->
                <div class="chart-container full-width">
                    <h3 class="chart-title">Daily Application Volume and Fraud Detection</h3>
                    <div class="chart-wrapper">
                        <canvas id="dailyTrendsChart"></canvas>
                    </div>
                </div>

                <!-- Fraud Reasons Analysis -->
                <div class="chart-container">
                    <h3 class="chart-title">Top Fraud Detection Reasons</h3>
                    <div class="chart-wrapper">
                        <canvas id="fraudReasonsChart"></canvas>
                    </div>
                </div>

                <!-- ISP Fraud Analysis -->
                <div class="chart-container">
                    <h3 class="chart-title">Fraud by Internet Service Provider</h3>
                    <div class="chart-wrapper">
                        <canvas id="ispFraudChart"></canvas>
                    </div>
                </div>

                <!-- Score Correlation Analysis -->
                <div class="chart-container full-width">
                    <h3 class="chart-title">Fraud Rate by Risk Score Ranges</h3>
                    <div class="chart-wrapper">
                        <canvas id="scoreCorrelationChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div id="error" style="display: none;" class="error">
            Error loading dashboard data. Please check the data file.
        </div>
    </div>

    <script>
        // Chart.js default configurations
        Chart.defaults.font.family = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
        Chart.defaults.plugins.legend.position = 'bottom';
        Chart.defaults.plugins.legend.labels.padding = 20;

        // Color palette
        const colors = {
            primary: '#667eea',
            secondary: '#764ba2',
            success: '#27ae60',
            danger: '#e74c3c',
            warning: '#f39c12',
            info: '#3498db',
            light: '#ecf0f1',
            dark: '#2c3e50',
            purple: '#9b59b6',
            orange: '#e67e22',
            teal: '#1abc9c'
        };

        // Load and display dashboard data
        async function loadDashboard() {
            try {
                const response = await fetch('dashboard_data.json');
                const data = await response.json();
                
                // Hide loading, show dashboard
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
                // Update summary statistics
                updateSummaryStats(data.summary);
                
                // Create charts
                createFraudStatusChart(data);
                createModelPerformanceChart(data);
                createMonthlyTrendsChart(data);
                createBehaviorScoresChart(data);
                createDeviceScoresChart(data);
                createDailyTrendsChart(data);
                createFraudReasonsChart(data);
                createIspFraudChart(data);
                createScoreCorrelationChart(data);
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
            }
        }

        function updateSummaryStats(summary) {
            document.getElementById('total-applications').textContent = summary.total_applications.toLocaleString();
            document.getElementById('fraud-rate').textContent = summary.fraud_rate + '%';
            document.getElementById('pass-rate').textContent = summary.pass_rate + '%';
            document.getElementById('review-rate').textContent = summary.manual_review_rate + '%';
        }

        function createFraudStatusChart(data) {
            const ctx = document.getElementById('fraudStatusChart').getContext('2d');
            
            // Calculate totals for each status
            const statusTotals = {};
            data.daily_trends.forEach(day => {
                Object.keys(day).forEach(key => {
                    if (key !== 'date') {
                        statusTotals[key] = (statusTotals[key] || 0) + day[key];
                    }
                });
            });

            // Calculate total and percentages
            const total = Object.values(statusTotals).reduce((sum, count) => sum + count, 0);
            const percentages = Object.values(statusTotals).map(count => ((count / total) * 100).toFixed(1));

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusTotals).map(key => key.replace('_', ' ')),
                    datasets: [{
                        data: percentages,
                        backgroundColor: [
                            colors.success,
                            colors.danger,
                            colors.warning,
                            colors.info,
                            colors.purple,
                            colors.orange
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const count = Object.values(statusTotals)[context.dataIndex];
                                    return `${label}: ${value}% (${count.toLocaleString()} cases)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createModelPerformanceChart(data) {
            const ctx = document.getElementById('modelPerformanceChart').getContext('2d');
            
            const labels = data.model_performance.map(item => item.model_result);
            const datasets = [
                {
                    label: 'Pass',
                    data: data.model_performance.map(item => item.Pass),
                    backgroundColor: colors.success
                },
                {
                    label: 'Fail',
                    data: data.model_performance.map(item => item.Fail),
                    backgroundColor: colors.danger
                },
                {
                    label: 'Confirmed Fraud',
                    data: data.model_performance.map(item => item.Confirmed_Fraud),
                    backgroundColor: colors.warning
                },
                {
                    label: 'Manual Review',
                    data: data.model_performance.map(item => item.Manual_Review + item.Manual_Review_No_Case),
                    backgroundColor: colors.info
                }
            ];

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createMonthlyTrendsChart(data) {
            const ctx = document.getElementById('monthlyTrendsChart').getContext('2d');
            
            const labels = data.monthly_trends.map(item => item.month);
            
            // Calculate total applications per month
            const totalApplications = data.monthly_trends.map(item => 
                item.Pass + item.Fail + item.Confirmed_Fraud + 
                item.Manual_Review + item.Manual_Review_No_Case + item.False_Positive
            );
            
            // Calculate fraud rate per month (confirmed fraud / total * 100)
            const fraudRates = data.monthly_trends.map(item => {
                const total = item.Pass + item.Fail + item.Confirmed_Fraud + 
                            item.Manual_Review + item.Manual_Review_No_Case + item.False_Positive;
                return total > 0 ? ((item.Confirmed_Fraud / total) * 100).toFixed(2) : 0;
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Total Applications',
                            data: totalApplications,
                            backgroundColor: colors.primary + '80',
                            borderColor: colors.primary,
                            borderWidth: 1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Fraud Rate (%)',
                            data: fraudRates,
                            type: 'line',
                            borderColor: colors.danger,
                            backgroundColor: colors.danger + '20',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: colors.danger,
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Total Applications',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                drawOnChartArea: true,
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            max: Math.max(...fraudRates) * 1.2, // Add some padding above max value
                            title: {
                                display: true,
                                text: 'Fraud Rate (%)',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Month',
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `Applications: ${context.parsed.y.toLocaleString()}`;
                                    } else {
                                        return `Fraud Rate: ${context.parsed.y}%`;
                                    }
                                }
                            }
                        }
                    }
                }
            });
        }

        function createBehaviorScoresChart(data) {
            const ctx = document.getElementById('behaviorScoresChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.behavior_scores.map(item => item.score),
                    datasets: [{
                        label: 'Count',
                        data: data.behavior_scores.map(item => item.count),
                        backgroundColor: colors.primary,
                        borderColor: colors.secondary,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createDeviceScoresChart(data) {
            const ctx = document.getElementById('deviceScoresChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.device_scores.map(item => item.score),
                    datasets: [{
                        label: 'Count',
                        data: data.device_scores.map(item => item.count),
                        backgroundColor: colors.teal,
                        borderColor: colors.dark,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createDailyTrendsChart(data) {
            const ctx = document.getElementById('dailyTrendsChart').getContext('2d');
            
            // Sample every 5th day to reduce clutter
            const sampledData = data.daily_trends.filter((_, index) => index % 5 === 0);
            
            const labels = sampledData.map(item => item.date);
            const datasets = [
                {
                    label: 'Total Applications',
                    data: sampledData.map(item => 
                        item.Pass + item.Fail + item.Confirmed_Fraud + 
                        item.Manual_Review + item.Manual_Review_No_Case + item.False_Positive
                    ),
                    borderColor: colors.primary,
                    backgroundColor: colors.primary + '20',
                    yAxisID: 'y'
                },
                {
                    label: 'Fraud Detection Rate (%)',
                    data: sampledData.map(item => {
                        const total = item.Pass + item.Fail + item.Confirmed_Fraud + 
                                     item.Manual_Review + item.Manual_Review_No_Case + item.False_Positive;
                        return total > 0 ? ((item.Confirmed_Fraud / total) * 100).toFixed(2) : 0;
                    }),
                    borderColor: colors.danger,
                    backgroundColor: colors.danger + '20',
                    yAxisID: 'y1',
                    type: 'line'
                }
            ];

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Applications'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Fraud Rate (%)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        function createFraudReasonsChart(data) {
            const ctx = document.getElementById('fraudReasonsChart').getContext('2d');
            
            if (!data.fraud_reasons || data.fraud_reasons.length === 0) {
                return;
            }

            new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    labels: data.fraud_reasons.map(item => item.reason),
                    datasets: [{
                        label: 'Occurrences',
                        data: data.fraud_reasons.map(item => item.count),
                        backgroundColor: colors.warning,
                        borderColor: colors.dark,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createIspFraudChart(data) {
            const ctx = document.getElementById('ispFraudChart').getContext('2d');
            
            if (!data.isp_fraud || data.isp_fraud.length === 0) {
                return;
            }

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.isp_fraud.map(item => item.isp),
                    datasets: [{
                        label: 'Fraud Cases',
                        data: data.isp_fraud.map(item => item.fraud_count),
                        backgroundColor: colors.danger,
                        borderColor: colors.dark,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        function createScoreCorrelationChart(data) {
            const ctx = document.getElementById('scoreCorrelationChart').getContext('2d');
            
            if (!data.score_correlations) {
                return;
            }

            const datasets = [];
            const labels = ['0-25', '26-50', '51-75', '76-100'];
            
            if (data.score_correlations.BEHAVIOR_CHECK_SCORE) {
                datasets.push({
                    label: 'Behavior Score Fraud Rate (%)',
                    data: labels.map(label => data.score_correlations.BEHAVIOR_CHECK_SCORE[label] || 0),
                    backgroundColor: colors.primary,
                    borderColor: colors.secondary,
                    borderWidth: 2
                });
            }
            
            if (data.score_correlations.DEVICE_CHECK_SCORE) {
                datasets.push({
                    label: 'Device Score Fraud Rate (%)',
                    data: labels.map(label => data.score_correlations.DEVICE_CHECK_SCORE[label] || 0),
                    backgroundColor: colors.teal,
                    borderColor: colors.dark,
                    borderWidth: 2
                });
            }

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Fraud Rate (%)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Score Range'
                            }
                        }
                    }
                }
            });
        }

        // Load dashboard when page loads
        document.addEventListener('DOMContentLoaded', loadDashboard);
    </script>
</body>
</html>
